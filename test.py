import unittest
from application.api.database import get_credentials

class Test(unittest.TestCase):
    credentials = get_credentials()

    def test_upload_file_imageKit(self):
        from application.model.imageKit_api import upload_file_imageKit
        from base64 import b64encode

        with open('test_image.png', 'rb') as image_file:
            image = b64encode(image_file.read())

        response = upload_file_imageKit(image, self.credentials)
        self.assertEqual(response['versionInfo']['name'], 'Version 1')

    def test_read_image(self):
        from application.model.azure_api import read_image
        from base64 import b64encode

        with open('test_image.png', 'rb') as image_file:
            image = b64encode(image_file.read())

        result = read_image(image, self.credentials)
        self.assertIn('6.35686-01-1', result[0])

    def test_preprocessing(self):
        from application.model.preprocessing_data import preprocess_data

        data = "{'EPIC & - ARE TRADEMARKS OF CBS INC. MADE IN HOLLAND','PE 34974',199,(04),'3313 RPM','BIEM STEMRA',(4:38),'@ 1977 C85 Inc.','THIS RECORD PROMBITED','EPC 82419','(9 : 08)','and Music Co/Pop Music C.',Epic,FORMANCE,'Produced by Todd Rundgren','MEAT LOAF','BAT OUT OF HELL','ORIZED PUBLIC',NMAN,'Edward B. Marks Music Corp.7','(HOT SUMMER NIGHT)','(Jim Steinman)',EVELAND,'4. ALL REVVED UP WITH NO PLACE TO GO','3. HEAVEN CAN WAIT','1. BAT OUT OF HELL','2. YOU TOOK THE WORDS RIGHT OUT OF MY MOUTH','LC 0199',34974,'EPC 8241.9-1',STEREO,'ALL RIGHTS OF THE MARUL','ACCORDED WORK RESERVED DA','TULHULUKER AND OF THE OWNER O','For crying out loud','You know I love you','I don't think that I can really survive','For crying out loud','I'll never break my promise or forget my vow','You know I love you','try for second; the ball is bobbled out in center,','But God only knows what I can do right now','For crying out loud','and here comes the throw, and what a throw!','I'm praying for the end of time','Cause two out of three ain't bad','He's gonna slide in head first, here he comes, he's out!','It's all that I can do','Don't be sad','No, wait, safe-safe at second base, this kid really','Praying for the end of time, so I can end my time with you! ! ! You know I love you','For taking in the rain when I'm feeling so dry','Cause two out of three ain't bad','makes things happen out there.','Baby we can talk all night','Batter steps up to the plate, here's the pitch --',BOY:,'For giving me the answers when I'm asking you why','he's going, and what a jump he's got, he's trying','It was long ago and it was far away','My oh my','But that ain't getting us nowhere','for third, here's the throw, it's in the dirt-','and it was so much better than it is today','For that I thank you','safe at third! Holy cow, stolen base!','PARADISE BY THE DASHBOARD LIGHT **','He's taking a pretty big lead out there, almost',GIRL:,'For taking in the sun when I'm feeling so cold','Featured Female Vocal: Ellen Foley','daring him to try and pick him off. The pitcher','Guitar: Todd Rundgren','glances over, winds up, and it's bunted, bunted','It never felt so good','For giving me a child when my body is old','Piano: Roy Bittan','down the third base line, the suicide squeeze is on!','It never felt so right','Don't you know','Bass: Kasim Sultan','Here he comes, squeeze play, it's gonna be close,','And we were glowing like','A metal on the edge of a knife','For that I need you','Drums: Max Weinberg','here's the throw, here's the play at the plate,','Saxophone: Edgar Winter','Keyboards: Jim Steinman, Roy Bittan','holy cow, I think he's gonna make it!','For coming to my room when you know I'm alone','Synthesizer: Roger Powel!','11. Let Me Sleep On It','FOR CRYING OUT LOUD','Background Vocals: Rory Dodd, Todd Rundgren,','For finding me a highway and for driving me home','Ellen Foley, Marvin Lee',GIRL:,'Solo Piano: Roy Bittan','Lascivious Effects: Jim Steinman','Stop right there!','Piano: Steve Margoshes, Cheryl Hardwick','You got to know','Baseball Play-by-Play: Phil (Scooter) Rizzuto (All-star','I gotta know right now!','Bass: Kasim Sultan','For that I serve you','Yankee shortstop and voice of the New York Yankees)','Before we go any further -!','Drums: John Wilcox','Do you love me?','Background Vocals: Rory Dodd','For pulling me away when I'm starting to fall','1. Paradise','Will you love me forever?','Arrangement: Steve Margoshes, Jim Steinman','For revving me up when I'm starting to stall',BOY:,'I remember every little thing','Do you need me?','Orchestra Arranged by: Steve Margoshes','And all in all','As if it happened only yesterday','Will you never leave me?','Concert Master: Gene Orloff','For that I want you','Parking by the lake','Will you make me so happy for the rest of my life?','Orchestra: Members of New York Philharmonic and','And there was not another car in sight','Will you take me away and will you make me your wife?','Philadelphia Orchestra','For taking and for giving and for playing the game','And I never had a girl','Do you love me !?','Looking any better than you did','Will you love me forever !?','I was lost till you were found','For praying for my future in the days that remain','And all the kids at school','Do you need me !?','But I never knew how far down','Oh Lord','They were wishing they were me that night','Will you never leave me !?','Will you make me so happy for the rest of my life !?','I was falling','For that I hold you','And now our bodies are ch so close and tight','Will you take me away and will you make me your wife !?','Before I reached the bottom','It never felt so good, it never felt so right','And we're glowing like the metal on the edge of a knife','I gotta know right now','I was cold and you were fire','Ah, but most of all','Glowing like the metal on the edge of a knife','Before we go any further','And I never knew how the pyre','For crying out loud','C'mon! Hold on tight!','Do you love me! ! ! ?','C'mon! Hold on tight!','Will you love me forever ! ! ! ?','Could be burning','For that I love you','On the edge of the ice field','Ah, but most of all','Though it's cold and lonely in the deep dark night','For crying out loud','I can see paradise by the dashboard light',BOY:,'And now the chilly California wind','For that I love you','Let me sleep on it','Baby, baby let me sleep on it','Is blowing down our bodies again','Ah, but most of all',GIRL:,'Ain't no doubt about it','Let me sleep on it','And we're sinking deeper and deeper in the','For crying out loud','We were doubly blessed','And I'll give you an answer in the morning','chilly California sand','Cause we were barely seventeen','Oh I know you belong inside my aching heart','For that I love you','And we were barely dressed','Let me sleep on it','Baby, baby let me sleep on it','And can't you see my faded Levis bursting apart','Let me sleep on it','And don't you hear me crying:','When you're crying out loud','Ain't no doubt about it','And I'll give you an answer in the morning','\'Oh Babe, don't go\'','You know I love you','Baby got to go and shout it','And don't you hear me screaming:','Ain't no doubt about it','We were doubly blessed','Let me sleep on it','\'How was | to know?\'','Baby, baby let me sleep on it',BOY,'Let me sleep on it','I'm in the middle of nowhere','All songs: @ 1977 Edward B. Marks Music Corp','Cause we were barely seventeen','Near the end of the line','And we were barely dressed','And I'll give you an answer In the morning','But there's a border to somewhere waiting','Neverland Music Company, and Pex Music Co',GIRL:,'And there's a tankful of time','Used by Permission, All Rights Res','Daby doncha hear my heart','You got it drowning out the radio','I gotta know right now!','Oh give me just another moment to see the light of the day','I've been waiting so long','Do you love me?','And take me to another land where I don't have to',em,'Will you love me forever?','And I'm gonna need somebody to make','Remixed by Jimmy','For you to come along and ha','\'Remixed i','And I will receive somebody','And i gotta let ya know','Do you need me?','No you're never gonna regret it','Will you never leave me?','Will you make me so happ','Open up the sky','Lo open up your eyes I got a big st','I'll feet all right','Will you take me away al','Well I wanna make your motor run','I gotta know rig',BA,And}"
        url = 'https://ik.imagekit.io/test/'

        result = preprocess_data(data, self.credentials[7], url, True, '-M')
        self.assertIsInstance(result, dict)


if __name__ == '__main__':
    unittest.main()